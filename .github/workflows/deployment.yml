name: Deployment

on:
  workflow_run: 
      workflows: ["Setup Github Repository"]
      branches: [master]
      types:
          - completed


jobs:
  conn_server:
    uses: ./.github.workflows/server_config.yml

  Deployment:
      name: Install Docker Compose
      needs: [conn_server]
      runs-on: ubuntu-latest

      steps:
          - name: Docker Compose Down
            run: |
              ssh -i PRIVATE_KEY.pem ubuntu@${{ secrets.SERVER_IP}} "cd ~/todo-app && sudo docker-compose down"

          - name: Docker Compose Up (Running in background)
            run: |
              ssh -i PRIVATE_KEY.pem ubuntu@${{ secrets.SERVER_IP}} "cd ~/todo-app && sudo docker-compose up -d"